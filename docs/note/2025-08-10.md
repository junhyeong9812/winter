# ğŸ¯ Winter Framework 26ì±•í„°: View Engine Integration êµ¬í˜„ ì‚¬í•­

## ğŸ“‹ **êµ¬í˜„ ê°œìš”**

**26ì±•í„°**ëŠ” Winter Frameworkë¥¼ ë‹¨ìˆœí•œ MVC í”„ë ˆì„ì›Œí¬ì—ì„œ **ë‹¤ì–‘í•œ ë·° ì—”ì§„ì„ ì§€ì›í•˜ëŠ” ìœ ì—°í•œ ì›¹ í”„ë ˆì„ì›Œí¬**ë¡œ ë°œì „ì‹œí‚¤ëŠ” í•µì‹¬ ì—…ë°ì´íŠ¸ì…ë‹ˆë‹¤.

---

## ğŸ—ï¸ **í•µì‹¬ ì•„í‚¤í…ì²˜ ë³€ê²½**

### 1. **View ì¸í„°í˜ì´ìŠ¤ í™•ì¥**
```java
// ê¸°ì¡´ (1-25ì±•í„°)
void render(Map<String,Object> model, HttpResponse response);

// ë³€ê²½ (26ì±•í„°)
void render(Map<String,Object> model, HttpRequest request, HttpResponse response);
```

**ë³€ê²½ ì´ìœ **: ë·° ì—”ì§„ì—ì„œ ìš”ì²­ ì •ë³´(í—¤ë”, ì„¸ì…˜ ë“±)ë¥¼ í™œìš©í•  ìˆ˜ ìˆë„ë¡ HttpRequest ì¶”ê°€

### 2. **HttpResponse Writer ì§€ì› ì¶”ê°€**
```java
public class HttpResponse {
    private PrintWriter writer;
    private StringWriter stringWriter;
    
    public PrintWriter getWriter();        // ìƒˆë¡œ ì¶”ê°€
    public void flushWriter();            // ìƒˆë¡œ ì¶”ê°€
    public void resetWriter();            // ìƒˆë¡œ ì¶”ê°€
}
```

**ëª©ì **: IntegratedViewì—ì„œ ìŠ¤íŠ¸ë¦¼ ë°©ì‹ìœ¼ë¡œ í…œí”Œë¦¿ ë Œë”ë§ ê²°ê³¼ ì¶œë ¥

---

## ğŸ¨ **ìƒˆë¡œìš´ ë·° ì—”ì§„ ì‹œìŠ¤í…œ**

### 1. **ViewEngine ì¸í„°í˜ì´ìŠ¤**
```java
public interface ViewEngine {
    String[] getSupportedExtensions();    // ì§€ì› í™•ì¥ì ë°˜í™˜
    String render(String templatePath, Map<String, Object> model, 
                  HttpRequest request, HttpResponse response) throws Exception;
    void initialize();                    // ì—”ì§„ ì´ˆê¸°í™”
    String getEngineName();              // ì—”ì§„ ì´ë¦„ ë°˜í™˜
    int getPriority();                   // ìš°ì„ ìˆœìœ„ ë°˜í™˜ (ë‚®ì„ìˆ˜ë¡ ë†’ì€ ìš°ì„ ìˆœìœ„)
}
```

### 2. **êµ¬í˜„ëœ 4ê°€ì§€ ë·° ì—”ì§„**

#### ğŸ”¹ **SimpleTemplateEngine** (ê¸°ë³¸ ì—”ì§„)
- **ì§€ì› í™•ì¥ì**: `.html`
- **ë¬¸ë²•**: `${ë³€ìˆ˜ëª…}`, `${user.name}` (ì  í‘œê¸°ë²• ì§€ì›)
- **ê¸°ëŠ¥**:
    - Reflectionì„ í†µí•œ ì¤‘ì²© ê°ì²´ ì ‘ê·¼
    - getter/isXxx ë©”ì„œë“œ ìë™ í˜¸ì¶œ
    - null ì•ˆì „ ì²˜ë¦¬
- **ìš°ì„ ìˆœìœ„**: 50

#### ğŸ”¹ **MockThymeleafEngine**
- **ì§€ì› í™•ì¥ì**: `.th`, `.thymeleaf`
- **ë¬¸ë²•**: `th:text`, `th:if`, `th:each` ì†ì„± ì‹œë®¬ë ˆì´ì…˜
- **ê¸°ëŠ¥**:
    - ì¡°ê±´ë¶€ ë Œë”ë§ (`th:if`)
    - ë°˜ë³µ ì²˜ë¦¬ (`th:each`)
    - í…ìŠ¤íŠ¸ ì¹˜í™˜ (`th:text`)
- **ìš°ì„ ìˆœìœ„**: 10

#### ğŸ”¹ **MockMustacheEngine**
- **ì§€ì› í™•ì¥ì**: `.mustache`
- **ë¬¸ë²•**: `{{ë³€ìˆ˜}}`, `{{#section}}`, `{{^inverted}}`
- **ê¸°ëŠ¥**:
    - ë³€ìˆ˜ ì¹˜í™˜
    - ì„¹ì…˜ ë Œë”ë§
    - ë°°ì—´/ë¦¬ìŠ¤íŠ¸ ìˆœíšŒ
- **ìš°ì„ ìˆœìœ„**: 20

#### ğŸ”¹ **MockJspEngine**
- **ì§€ì› í™•ì¥ì**: `.jsp`
- **ë¬¸ë²•**: `<%= ë³€ìˆ˜ %>`, `<% ì½”ë“œ %>` ìŠ¤í¬ë¦½í‹€ë¦¿ ì‹œë®¬ë ˆì´ì…˜
- **ê¸°ëŠ¥**:
    - í‘œí˜„ì‹ íƒœê·¸ ì²˜ë¦¬
    - ìŠ¤í¬ë¦½í‹€ë¦¿ ì‹œë®¬ë ˆì´ì…˜
    - JSP ë‚´ì¥ ê°ì²´ ëª¨ë°©
- **ìš°ì„ ìˆœìœ„**: 30

### 3. **ViewEngineRegistry** (ì—”ì§„ ê´€ë¦¬ì)
```java
public class ViewEngineRegistry {
    private Map<String, ViewEngine> extensionEngineMap;     // í™•ì¥ìë³„ ì—”ì§„ ë§¤í•‘
    private List<ViewEngine> registeredEngines;            // ë“±ë¡ëœ ì—”ì§„ ëª©ë¡
    private ViewEngine defaultEngine;                      // ê¸°ë³¸ ì—”ì§„
    
    // í•µì‹¬ ë©”ì„œë“œ
    public void registerEngine(ViewEngine engine);         // ì—”ì§„ ë“±ë¡
    public ViewEngine getEngineForTemplate(String path);   // í…œí”Œë¦¿ì— ë§ëŠ” ì—”ì§„ ë°˜í™˜
    public void setDefaultEngine(ViewEngine engine);       // ê¸°ë³¸ ì—”ì§„ ì„¤ì •
}
```

**ê¸°ëŠ¥**:
- ìš°ì„ ìˆœìœ„ ê¸°ë°˜ ì—”ì§„ ì„ íƒ
- í™•ì¥ìë³„ ìë™ ë§¤í•‘
- ê¸°ë³¸ ì—”ì§„ fallback ì§€ì›

---

## ğŸ”„ **í†µí•© ë·° í•´ê²° ì‹œìŠ¤í…œ**

### 1. **IntegratedViewResolver**
```java
public class IntegratedViewResolver implements ViewResolver {
    private ViewEngineRegistry engineRegistry;
    private ContentNegotiatingViewResolver contentNegotiatingViewResolver;
    
    @Override
    public View resolveViewName(String viewName) {
        // 1. JSON ë·° ìš°ì„  í™•ì¸ (Content Negotiation)
        // 2. í…œí”Œë¦¿ íŒŒì¼ í›„ë³´ ê²€ìƒ‰
        // 3. ì ì ˆí•œ ë·° ì—”ì§„ ì„ íƒ
        // 4. IntegratedView ìƒì„±
    }
}
```

**í•´ê²° ê³¼ì •**:
1. **Content Negotiation**: `Accept: application/json` â†’ JsonView ë°˜í™˜
2. **í…œí”Œë¦¿ ê²€ìƒ‰**: ë·°ëª… + ì§€ì› í™•ì¥ìë¡œ íŒŒì¼ íƒìƒ‰
3. **ìš°ì„ ìˆœìœ„ ì •ë ¬**: ë·° ì—”ì§„ ìš°ì„ ìˆœìœ„ì— ë”°ë¼ ì •ë ¬
4. **ë·° ìƒì„±**: ì„ íƒëœ ì—”ì§„ê³¼ í…œí”Œë¦¿ìœ¼ë¡œ IntegratedView ìƒì„±
5. **Fallback**: ì ì ˆí•œ ì—”ì§„ì´ ì—†ìœ¼ë©´ ì—ëŸ¬ ë·° ìƒì„±

### 2. **IntegratedView**
```java
public class IntegratedView implements View {
    private ViewEngine engine;
    private String templatePath;
    
    @Override
    public void render(Map<String, Object> model, HttpRequest request, HttpResponse response) {
        // 1. ë·° ì—”ì§„ìœ¼ë¡œ í…œí”Œë¦¿ ë Œë”ë§
        // 2. Writerë¥¼ í†µí•´ ê²°ê³¼ ì¶œë ¥
        // 3. ì—ëŸ¬ ì‹œ ì‚¬ìš©ì ì¹œí™”ì  ì—ëŸ¬ í˜ì´ì§€ ìƒì„±
    }
}
```

---

## ğŸ® **í…ŒìŠ¤íŠ¸ ì‹œìŠ¤í…œ**

### 1. **ViewEngineController** (8ê°€ì§€ í…ŒìŠ¤íŠ¸)
```java
@Controller
public class ViewEngineController {
    @RequestMapping("/view/simple")     // SimpleTemplateEngine í…ŒìŠ¤íŠ¸
    @RequestMapping("/view/thymeleaf")  // MockThymeleafEngine í…ŒìŠ¤íŠ¸
    @RequestMapping("/view/mustache")   // MockMustacheEngine í…ŒìŠ¤íŠ¸
    @RequestMapping("/view/jsp")        // MockJspEngine í…ŒìŠ¤íŠ¸
    @RequestMapping("/view/priority")   // ìš°ì„ ìˆœìœ„ í…ŒìŠ¤íŠ¸
    @RequestMapping("/view/nonexistent") // 404 ì—ëŸ¬ í…ŒìŠ¤íŠ¸
    @RequestMapping("/view/performance") // ì„±ëŠ¥ ë¹„êµ í…ŒìŠ¤íŠ¸
    @RequestMapping("/view/info")       // ì—”ì§„ ì •ë³´ ì¡°íšŒ
}
```

### 2. **WinterMain í†µí•© í…ŒìŠ¤íŠ¸**
```java
private static void testViewEngineIntegration(Dispatcher dispatcher) {
    // 10ê°œì˜ í¬ê´„ì ì¸ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
    // 1. SimpleTemplateEngine
    // 2. MockThymeleafEngine
    // 3. MockMustacheEngine
    // 4. MockJspEngine
    // 5. ì¡´ì¬í•˜ì§€ ì•ŠëŠ” í…œí”Œë¦¿ (404)
    // 6. ë·° ì—”ì§„ ìš°ì„ ìˆœìœ„
    // 7. ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
    // 8. ì—”ì§„ ì •ë³´ ì¡°íšŒ
    // 9. JSON vs HTML Content Negotiation
    // 10. ë Œë”ë§ ì˜¤ë¥˜ ì²˜ë¦¬
}
```

---

## ğŸ“ **íŒŒì¼ êµ¬ì¡°**

### **ìƒˆë¡œ ìƒì„±ëœ íŒŒì¼ë“¤**
```
src/winter/view/engine/
â”œâ”€â”€ ViewEngine.java                    # ë·° ì—”ì§„ ì¸í„°í˜ì´ìŠ¤
â”œâ”€â”€ ViewEngineRegistry.java           # ì—”ì§„ ê´€ë¦¬ì
â”œâ”€â”€ SimpleTemplateEngine.java         # ê¸°ë³¸ í…œí”Œë¦¿ ì—”ì§„
â”œâ”€â”€ MockThymeleafEngine.java          # Thymeleaf ì‹œë®¬ë ˆì´ì…˜
â”œâ”€â”€ MockMustacheEngine.java           # Mustache ì‹œë®¬ë ˆì´ì…˜
â””â”€â”€ MockJspEngine.java                # JSP ì‹œë®¬ë ˆì´ì…˜

src/winter/view/
â”œâ”€â”€ IntegratedView.java               # í†µí•© ë·° êµ¬í˜„ì²´
â””â”€â”€ IntegratedViewResolver.java       # í†µí•© ë·° í•´ê²°ì

src/winter/controller/
â””â”€â”€ ViewEngineController.java         # ë·° ì—”ì§„ í…ŒìŠ¤íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬

src/winter/templates/
â”œâ”€â”€ view-simple.html                  # SimpleTemplateEngineìš©
â”œâ”€â”€ view-thymeleaf.th                 # MockThymeleafEngineìš©
â”œâ”€â”€ view-mustache.mustache            # MockMustacheEngineìš©
â””â”€â”€ view-jsp.jsp                      # MockJspEngineìš©
```

### **ìˆ˜ì •ëœ ê¸°ì¡´ íŒŒì¼ë“¤**
```
src/winter/view/
â”œâ”€â”€ View.java                         # ì¸í„°í˜ì´ìŠ¤ì— HttpRequest ì¶”ê°€
â”œâ”€â”€ JsonView.java                     # render ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜ ë³€ê²½
â”œâ”€â”€ InternalResourceView.java         # render ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜ ë³€ê²½
â”œâ”€â”€ InternalResourceViewLegacy.java   # render ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜ ë³€ê²½
â””â”€â”€ ModelAndView.java                 # í¸ì˜ ìƒì„±ì ì¶”ê°€

src/winter/http/
â””â”€â”€ HttpResponse.java                 # getWriter() ë©”ì„œë“œ ì¶”ê°€

src/winter/dispatcher/
â””â”€â”€ Dispatcher.java                   # IntegratedViewResolver ì‚¬ìš©

src/winter/
â””â”€â”€ WinterMain.java                   # 26ì±•í„° í…ŒìŠ¤íŠ¸ ì¶”ê°€
```

---

## ğŸ”§ **ì—…ë°ì´íŠ¸ëœ ê¸°ëŠ¥ë“¤**

### 1. **ModelAndView ê°œì„ **
```java
// ê¸°ì¡´ ë°©ì‹ (1-25ì±•í„°)
ModelAndView mv = new ModelAndView("products");
mv.addAttribute("title", "ìƒí’ˆ ëª©ë¡");
mv.addAttribute("products", productList);

// ìƒˆë¡œìš´ ë°©ì‹ (26ì±•í„°)
Map<String, Object> model = new HashMap<>();
model.put("title", "ìƒí’ˆ ëª©ë¡");
model.put("products", productList);
ModelAndView mv = new ModelAndView("products", model);

// í˜¼í•© ì‚¬ìš©
ModelAndView mv = new ModelAndView("products", baseModel);
mv.addAttribute("timestamp", System.currentTimeMillis());
```

### 2. **Dispatcher ì—…ë°ì´íŠ¸**
```java
// ê¸°ì¡´: ContentNegotiatingViewResolver ì‚¬ìš©
ContentNegotiatingViewResolver viewResolver = new ContentNegotiatingViewResolver();

// ë³€ê²½: IntegratedViewResolver ì‚¬ìš©
IntegratedViewResolver viewResolver = new IntegratedViewResolver();
viewResolver.setCurrentRequest(request);
View view = viewResolver.resolveViewName(mv.getViewName());
view.render(mv.getModel(), request, response); // HttpRequest ì¶”ê°€
```

---

## ğŸ¯ **í•µì‹¬ ì•Œê³ ë¦¬ì¦˜**

### 1. **ë·° ì—”ì§„ ì„ íƒ ì•Œê³ ë¦¬ì¦˜**
```
1. ë·°ëª…ì—ì„œ í…œí”Œë¦¿ íŒŒì¼ í›„ë³´ë“¤ ê²€ìƒ‰
   - ì˜ˆ: "view-simple" â†’ ["view-simple.html", "view-simple.th", ...]

2. ì¡´ì¬í•˜ëŠ” íŒŒì¼ë“¤ë§Œ í•„í„°ë§
   - ì‹¤ì œ íŒŒì¼ ì‹œìŠ¤í…œì—ì„œ ì¡´ì¬ ì—¬ë¶€ í™•ì¸

3. ìš°ì„ ìˆœìœ„ì— ë”°ë¼ ì •ë ¬
   - MockThymeleafEngine (10) > MockMustacheEngine (20) > MockJspEngine (30) > SimpleTemplateEngine (50)

4. ì²« ë²ˆì§¸ íŒŒì¼ì˜ ì—”ì§„ ì„ íƒ
   - ê°€ì¥ ë†’ì€ ìš°ì„ ìˆœìœ„ì˜ ì—”ì§„ ì‚¬ìš©

5. IntegratedView ìƒì„±
   - ì„ íƒëœ ì—”ì§„ê³¼ í…œí”Œë¦¿ ê²½ë¡œë¡œ ë·° ê°ì²´ ìƒì„±
```

### 2. **Content Negotiation ì•Œê³ ë¦¬ì¦˜**
```
1. Accept í—¤ë” í™•ì¸
   - "application/json" â†’ JsonView ë°˜í™˜
   - "text/html" ë˜ëŠ” ì—†ìŒ â†’ í…œí”Œë¦¿ ë·° ì²˜ë¦¬

2. í…œí”Œë¦¿ ë·° í•´ê²°
   - ë·° ì—”ì§„ ì„ íƒ ì•Œê³ ë¦¬ì¦˜ ì‹¤í–‰

3. ê²°ê³¼ ë°˜í™˜
   - JsonView ë˜ëŠ” IntegratedView
```

---

## ğŸ“Š **ì„±ëŠ¥ íŠ¹ì„±**

### 1. **ë·° ì—”ì§„ë³„ ì„±ëŠ¥**
- **SimpleTemplateEngine**: ê°€ì¥ ë¹ ë¦„ (ì •ê·œì‹ + Reflection)
- **MockThymeleafEngine**: ì¤‘ê°„ (XML íŒŒì‹± ì‹œë®¬ë ˆì´ì…˜)
- **MockMustacheEngine**: ì¤‘ê°„ (í…œí”Œë¦¿ íŒŒì‹±)
- **MockJspEngine**: ëŠë¦¼ (ë³µì¡í•œ ìŠ¤í¬ë¦½í‹€ë¦¿ ì²˜ë¦¬)

### 2. **ìµœì í™” ìš”ì†Œ**
- **í™•ì¥ì ë§µ ìºì‹±**: O(1) ì—”ì§„ ê²€ìƒ‰
- **ìš°ì„ ìˆœìœ„ ì •ë ¬**: í•œ ë²ˆë§Œ ìˆ˜í–‰
- **í…œí”Œë¦¿ íŒŒì¼ ì¡´ì¬ í™•ì¸**: íŒŒì¼ ì‹œìŠ¤í…œ ì ‘ê·¼ ìµœì†Œí™”
- **ì—ëŸ¬ ë·° ìºì‹±**: ë°˜ë³µì ì¸ ì—ëŸ¬ í˜ì´ì§€ ìƒì„± ë°©ì§€

---

## ğŸš€ **í™•ì¥ ê°€ëŠ¥ì„±**

### 1. **ìƒˆë¡œìš´ ë·° ì—”ì§„ ì¶”ê°€**
```java
// ìƒˆë¡œìš´ ë·° ì—”ì§„ êµ¬í˜„
public class ReactServerSideEngine implements ViewEngine {
    @Override
    public String[] getSupportedExtensions() {
        return new String[]{"jsx", "tsx"};
    }
    
    @Override
    public String render(String templatePath, Map<String, Object> model, 
                        HttpRequest request, HttpResponse response) throws Exception {
        // React Server Side Rendering ë¡œì§
    }
}

// ë“±ë¡
viewEngineRegistry.registerEngine(new ReactServerSideEngine());
```

### 2. **ì‹¤ì œ ë¼ì´ë¸ŒëŸ¬ë¦¬ í†µí•©**
```java
// ì‹¤ì œ Thymeleaf ì—”ì§„
public class RealThymeleafEngine implements ViewEngine {
    private TemplateEngine templateEngine;
    
    @Override
    public void initialize() {
        this.templateEngine = new TemplateEngine();
        // Thymeleaf ì„¤ì •
    }
    
    @Override
    public String render(String templatePath, Map<String, Object> model, 
                        HttpRequest request, HttpResponse response) throws Exception {
        Context context = new Context();
        context.setVariables(model);
        return templateEngine.process(templatePath, context);
    }
}
```

---

## ğŸ‰ **26ì±•í„°ì˜ ì˜ì˜**

### 1. **ì•„í‚¤í…ì²˜ ì§„í™”**
- **ë‹¨ì¼ ì±…ì„ ì›ì¹™**: ê° ë·° ì—”ì§„ì´ íŠ¹ì • í…œí”Œë¦¿ í˜•ì‹ë§Œ ë‹´ë‹¹
- **ê°œë°©-íì‡„ ì›ì¹™**: ìƒˆë¡œìš´ ë·° ì—”ì§„ ì¶”ê°€ ì‹œ ê¸°ì¡´ ì½”ë“œ ìˆ˜ì • ë¶ˆí•„ìš”
- **ì˜ì¡´ì„± ì—­ì „ ì›ì¹™**: ViewEngine ì¸í„°í˜ì´ìŠ¤ì— ì˜ì¡´

### 2. **ì‹¤ë¬´ ì—°ê´€ì„±**
- **Spring Boot**: ì‹¤ì œë¡œ ì—¬ëŸ¬ ë·° ì—”ì§„ ì§€ì› (Thymeleaf, Mustache, JSP)
- **ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤**: ì„œë¹„ìŠ¤ë³„ë¡œ ë‹¤ë¥¸ ë·° ê¸°ìˆ  ì„ íƒ ê°€ëŠ¥
- **ë ˆê±°ì‹œ ë§ˆì´ê·¸ë ˆì´ì…˜**: ì ì§„ì  ë·° ê¸°ìˆ  ì „í™˜ ì§€ì›

### 3. **í•™ìŠµ íš¨ê³¼**
- **ë””ìì¸ íŒ¨í„´**: Strategy, Factory, Registry íŒ¨í„´ í•™ìŠµ
- **í”ŒëŸ¬ê·¸ì¸ ì•„í‚¤í…ì²˜**: í™•ì¥ ê°€ëŠ¥í•œ ì‹œìŠ¤í…œ ì„¤ê³„
- **í…œí”Œë¦¿ ì—”ì§„**: ë‹¤ì–‘í•œ í…œí”Œë¦¿ ê¸°ìˆ ì˜ íŠ¹ì„± ì´í•´

---

