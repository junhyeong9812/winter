📁 Winter Framework 27단계: HandlerInterceptor 체인 구조
===========================================================

📂 프로젝트 구조
├── src/winter/
│   ├── 🔗 interceptor/                    (27단계 새로 추가)
│   │   ├── HandlerInterceptor.java        [인터페이스] 인터셉터 기본 구조
│   │   ├── InterceptorChain.java          [핵심] 인터셉터 체인 관리
│   │   ├── LoggingInterceptor.java        [구현] 요청/응답 로깅
│   │   ├── PerformanceInterceptor.java    [구현] 성능 측정 및 모니터링
│   │   ├── AuthenticationInterceptor.java [구현] 세션 기반 인증
│   │   ├── CorsInterceptor.java           [구현] CORS 헤더 및 Preflight 처리
│   │   └── SecurityInterceptor.java       [구현] 보안 헤더 및 공격 차단
│   │
│   ├── 📋 controller/
│   │   └── InterceptorTestController.java [테스트] 인터셉터 테스트용 컨트롤러
│   │
│   ├── 🎯 dispatcher/
│   │   └── Dispatcher.java                [수정] 인터셉터 체인 통합
│   │
│   ├── 🎨 templates/                      (27단계 템플릿 추가)
│   │   ├── interceptor-basic.html         [템플릿] 기본 인터셉터 테스트
│   │   ├── slow-test.html                 [템플릿] 성능 테스트 결과
│   │   ├── secure-test.html               [템플릿] 보안 페이지
│   │   ├── admin-dashboard.html           [템플릿] 관리자 대시보드
│   │   ├── login.html                     [템플릿] 로그인 페이지
│   │   ├── login-success.html             [템플릿] 로그인 성공
│   │   └── logout.html                    [템플릿] 로그아웃
│   │
│   └── WinterMain.java                    [수정] 27단계 테스트 시나리오

🔥 주요 구현 내용
=================

1️⃣ HandlerInterceptor 인터페이스
• preHandle(): 핸들러 실행 전 호출
• postHandle(): 핸들러 실행 후, 뷰 렌더링 전 호출
• afterCompletion(): 모든 처리 완료 후 호출 (정리 작업)

2️⃣ InterceptorChain 체인 관리
• 인터셉터 등록 및 순서 관리
• preHandle 순방향 실행 (A→B→C)
• postHandle/afterCompletion 역방향 실행 (C→B→A)
• 예외 안전성 보장 (afterCompletion 반드시 실행)

3️⃣ 기본 인터셉터 구현
• LoggingInterceptor: 상세 요청/응답 로깅, 처리 시간 측정
• PerformanceInterceptor: 성능 모니터링, 느린 요청 감지
• AuthenticationInterceptor: 세션 기반 인증, 권한 확인
• CorsInterceptor: Cross-Origin 요청 처리, Preflight 지원
• SecurityInterceptor: 보안 헤더 설정, 공격 패턴 차단

4️⃣ Dispatcher 통합
• 인터셉터 체인을 요청 처리 흐름에 통합
• 예외 발생 시에도 afterCompletion 보장
• 기존 26단계 기능과 완벽 호환

🚀 실행 방법
============

1️⃣ 컴파일 및 실행
   ```bash
   # 프로젝트 루트에서
   javac -d out src/winter/**/*.java
   java -cp out winter.WinterMain
   ```

2️⃣ 실행 시 확인 사항
✅ 인터셉터 체인 등록 로그
✅ 9가지 테스트 시나리오 실행
✅ 각 인터셉터의 preHandle → postHandle → afterCompletion 순서
✅ 예외 발생 시에도 정리 작업 실행
✅ 성능 측정 및 보안 검사 동작

📊 테스트 시나리오
==================

🔥 테스트 1: 기본 인터셉터 체인
• URL: GET /interceptor/basic
• 모든 인터셉터가 정상 순서로 실행되는지 확인

🔥 테스트 2: 성능 측정 인터셉터
• URL: GET /interceptor/slow
• 2초 지연 후 성능 경고 메시지 출력 확인

🔥 테스트 3: 인증 인터셉터 (미인증)
• URL: GET /secure/test (세션 없음)
• 302 리다이렉트로 로그인 페이지 이동 확인

🔥 테스트 4: 로그인 후 인증된 요청
• URL: POST /login → GET /secure/test
• 세션 기반 인증 성공 확인

🔥 테스트 5: 관리자 권한 테스트
• URL: POST /login (admin) → GET /admin/dashboard
• 역할 기반 접근 제어 확인

🔥 테스트 6: CORS 인터셉터
• URL: OPTIONS → GET /api/cors-test (Origin 헤더 포함)
• Preflight 요청 처리 및 CORS 헤더 설정 확인

🔥 테스트 7: 예외 처리
• URL: GET /interceptor/error
• 예외 발생 시에도 afterCompletion 실행 확인

🔥 테스트 8: JSON API 인터셉터
• URL: GET /api/interceptor-test
• JSON 응답과 인터셉터 조합 확인

🔥 테스트 9: 보안 인터셉터
• SQL Injection, XSS 패턴 차단 확인
• 보안 헤더 자동 추가 확인

🎯 기대 결과
============

📋 콘솔 출력 예시:
```
=== preHandle 체인 실행 시작 ===
preHandle 실행: CorsInterceptor [0]
preHandle 성공: CorsInterceptor
preHandle 실행: LoggingInterceptor [1]
┌─────────────────────────────────────────────────────────
│ [요청 시작] 2025-08-12 15:30:45.123
│ Request ID: A1B2C3D4
│ Method: GET
│ Path: /interceptor/basic
└─────────────────────────────────────────────────────────
preHandle 성공: LoggingInterceptor
preHandle 실행: PerformanceInterceptor [2]
🚀 [PERF] 요청 시작 - GET /interceptor/basic
preHandle 성공: PerformanceInterceptor
preHandle 실행: AuthenticationInterceptor [3]
🔐 [AUTH] 인증 확인: GET /interceptor/basic
   ✅ 비보호 리소스 - 인증 생략
preHandle 성공: AuthenticationInterceptor
=== preHandle 체인 실행 완료 (성공) ===

🎯 [CONTROLLER] 기본 인터셉터 테스트 실행

=== postHandle 체인 실행 시작 ===
postHandle 실행: AuthenticationInterceptor [3]
postHandle 완료: AuthenticationInterceptor
postHandle 실행: PerformanceInterceptor [2]
⚡ [PERF] 핸들러 완료 - GET /interceptor/basic
   핸들러 처리 시간: 15ms
postHandle 완료: PerformanceInterceptor
postHandle 실행: LoggingInterceptor [1]
postHandle 완료: LoggingInterceptor
postHandle 실행: CorsInterceptor [0]
postHandle 완료: CorsInterceptor
=== postHandle 체인 실행 완료 ===

=== afterCompletion 체인 실행 시작 ===
afterCompletion 실행: AuthenticationInterceptor [3]
afterCompletion 완료: AuthenticationInterceptor
afterCompletion 실행: PerformanceInterceptor [2]
📊 [PERF] 처리 완료 - GET /interceptor/basic
   총 처리 시간: 45ms
afterCompletion 완료: PerformanceInterceptor
afterCompletion 실행: LoggingInterceptor [1]
┌─────────────────────────────────────────────────────────
│ [요청 완료] 2025-08-12 15:30:45.168
│ Request ID: A1B2C3D4
│ 총 처리 시간: 45ms
│ ✅ 정상 처리 완료
└─────────────────────────────────────────────────────────
afterCompletion 완료: LoggingInterceptor
afterCompletion 실행: CorsInterceptor [0]
afterCompletion 완료: CorsInterceptor
=== afterCompletion 체인 실행 완료 ===
```

🌟 27단계 핵심 성과
===================

✅ Spring MVC HandlerInterceptor 패턴 완벽 구현
✅ 횡단 관심사와 비즈니스 로직의 완전한 분리
✅ 5가지 실용적인 인터셉터 구현 (로깅, 성능, 인증, CORS, 보안)
✅ 예외 안전성이 보장되는 체인 구조
✅ 기존 26단계 기능과 100% 호환성 유지
✅ 확장 가능한 인터셉터 아키텍처

🔮 28단계 예고
==============

다음 단계에서는 Bean Validation API 통합을 구현합니다:
• @Valid, @NotNull, @Size 등 어노테이션 기반 유효성 검사
• ValidationInterceptor를 통한 자동 검증
• 커스텀 Validator 지원
• 검증 실패 시 자동 에러 응답 생성

💡 학습 포인트
==============

1️⃣ 디자인 패턴 이해
• Chain of Responsibility 패턴
• Template Method 패턴  
• Decorator 패턴

2️⃣ 아키텍처 설계 원칙
• 단일 책임 원칙 (SRP)
• 개방-폐쇄 원칙 (OCP)
• 의존성 역전 원칙 (DIP)

3️⃣ 실무 적용 지식
• 횡단 관심사 분리
• 예외 안전 프로그래밍
• 성능 모니터링 및 보안 강화